<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="cn.soa.dao.lubrication.EquipmentLubricationMapper">

	
	<!-- 设备润滑油品 -->
	<sql id="lubEquimentLubricateSQL">
		ROWNUM rn,LID,LNAMEKEY,LNAME,LNUMBER,LSTATE,LTYPE,LPOSITION1,LPOSITION2,ISUSER,LREMARK1,LREMARK2
	</sql>
	
	<!-- 设备润滑油品记录 -->
	<sql id="lubEquimentLubricatePlaceSQL">
		PID,LID,PPLACE,PNOTE,PTYPE,REQUIREOIL1,REQUIREOIL2,PFREQUENCY,PUNIT,PLASTAMOUNT,PAMOUNT,NEXTCHANGETIME,LASTCHANGETIME,PREMARK1,PREMARK2
	</sql>
	
	<!-- 设备润滑油品记录 -->
	<sql id="lubEquimentLubricateRecordSQL">
		RID,LID,PID,OID,EXCUTOR,PTIME,OPERATESTATE,OPERATETYPE,RNOTE,RAMOUNT,RREMARK1,RREMARK2		
	</sql>
	
	<!-- ===================================查询=================================== -->
	
	<!-- 查询换油设备 -->
	<!-- List<LubricatelubEquiment> findLubEqui(LubricateEquipment lubricateEquipment); -->
	<select id="findLubEqui" resultType="cn.soa.entity.lubrication.LubricateEquipment">
		SELECT 
			<include refid="lubEquimentLubricateSQL"></include>
          FROM 
          	IOT_EQUIPMENT_LUBRICATE
          WHERE 1=1
          <if test="lid != null and lid != ''">
					AND lid = #{lid}
		  </if>
		  <if test="lnamekey != null and lnamekey != ''">
					AND lnamekey = #{lnamekey}
		  </if>
		  <if test="lname != null and lname != ''">
					AND lname = #{lname}
		  </if>
		  <if test="lnumber != null and lnumber != ''">
					AND lnumber = #{lnumber}
		  </if>
		  <if test="lstate != null and lstate != ''">
					AND lstate = #{lstate}
		  </if>
		  <if test="ltype != null and ltype != ''">
					AND ltype = #{ltype}
		  </if>
		  <if test="lposition1 != null and lposition1 != ''">
					AND lposition1 = #{lposition1}
		  </if>
		  <if test="lposition2 != null and lposition2 != ''">
					AND lposition2 = #{lposition2}
		  </if>
		  <if test="isuser != null and isuser != ''">
					AND isuser = #{isuser}
		  </if>
		  <if test="lremark1 != null and lremark1 != ''">
					AND lremark1 = #{lremark1}
		  </if>
		   <if test="lremark2 != null and lremark2 != ''">
					AND lremark2 = #{lremark2}
		  </if>
		  
	</select>
	
	<!-- 查询所有油品数量 -->
	<!-- Integer countStock(); -->
	<!-- <select id="countStock" resultType="java.lang.Integer">
		SELECT
			count(*)
		FROM
			IOT_lubEquiMENT_LUBRICATION_OIL
	</select>
	
	List<lubEquimentOilRecordVO> findOilAll();
	<select id="findOilAll" resultType="cn.soa.entity.lubrication.lubEquimentOilRecordVO">
		SELECT 
			<include refid="lubEquimentOilRecordVOSQL"></include>
          FROM (SELECT 
	          		<include refid="lubEquimentOilRecordVOSQL"></include>
	            FROM 
	            	IOT_lubEquiMENT_OIL_RECORD record,IOT_lubEquiMENT_LUBRICATION_OIL oil
				WHERE 
					record.oid = oil.oid 
				<if test="oid != null and oid != ''">
					AND oil.OID = #{oid}
				</if>
				<if test="startTime != null and startTime != ''">
					AND rtime <![CDATA[ >= ]]> to_date(#{startTime,jdbcType=DATE},'yyyy-mm-dd')
				</if>
				<if test="endTime != null and endTime != ''">
					AND rtime <![CDATA[ <= ]]> to_date(#{endTime,jdbcType=DATE},'yyyy-mm-dd')
				</if>
					and ROWNUM <![CDATA[ <= ]]> #{maxSize}
 					 ORDER BY rtime
 					 ) oil

 		WHERE 
 			rn <![CDATA[ > ]]>  #{minSize} 
 		
	</select>
	
	查询油品出入库总数量
	Integer countRecord();
	<select id="countRecord" resultType="java.lang.Integer">
		SELECT
			count(*)
		FROM
			IOT_lubEquiMENT_OIL_RECORD record,IOT_lubEquiMENT_LUBRICATION_OIL oil
		WHERE 
			record.oid = oil.oid 
			<if test="oid != null and oid != ''">
					AND oil.OID = #{oid}
				</if> 
				<if test="startTime != null and startTime != ''">
					AND rtime <![CDATA[ >= ]]> to_date(#{startTime,jdbcType=DATE},'yyyy-mm-dd')
				</if>
				<if test="endTime != null and endTime != ''">
					AND rtime <![CDATA[ <= ]]> to_date(#{endTime,jdbcType=DATE},'yyyy-mm-dd')
				</if>
	</select>
	
	 根据油品库存条件查询油品
	public List<lubEquimentLubricationOil> findOilbyConditions(lubEquimentLubricationOil lubEquimentLubricationOil);
	<select id="findOilbyConditions" resultType="cn.soa.entity.lubrication.lubEquimentLubricationOil">
		SELECT
			<include refid="lubEquimentLubricationOilSQL"></include>
		FROM
			IOT_lubEquiMENT_LUBRICATION_OIL
		WHERE 
			1 = 1
			<if test="oid != null and oid != ''">
					and oid = #{oid}
				</if>
				<if test="oname != null and oname != ''">
					and oname = #{oname} 
				</if>
				<if test="ostock != null and ostock != ''">
					and ostock = #{ostock} 
				</if>
				<if test="ostate != null and ostate != ''">
					and ostate = #{ostate}
				</if>
				<if test="ounit != null and ounit != ''">
					and ounit = #{ounit} 
				</if>
				<if test="odescribe != null and odescribe != ''">
					and odescribe = #{odescribe} 
				</if>
				<if test="otype != null and otype != ''">
					and otype = #{otype} 
				</if>
				<if test="manufacture != null and manufacture != ''">
					and manufacture = #{manufacture} 
				</if>
				<if test="osign != null and osign != ''">
					and osign = #{osign} 
				</if>
				<if test="oremark1 != null and oremark1 != ''">
					and oremark1 = #{oremark1} 
				</if>
				<if test="oremark2 != null and oremark2 != ''">
					and oremark2 = #{oremark2} 
				</if>
	</select> -->
	
	
	<!-- ===========================2、新增===============================  -->
	<!-- 设备润滑换油新增 -->
	<!-- Integer insertLubEqui(LubricateEquipment lubricateEquipment); -->
	<insert id="insertLubEqui"	parameterType="cn.soa.entity.lubrication.LubricateEquipment">
		<selectKey order="BEFORE" resultType="string" keyProperty="lubequi.lid">
			select sys_guid() from dual 
		</selectKey>
	
		INSERT INTO
			IOT_EQUIPMENT_LUBRICATE
			<trim prefix="(" suffix=")" suffixOverrides=",">
				<if test="lubequi.lid != null and lubequi.lid != ''">
					LID,
				</if>
				<if test="lubequi.lnamekey != null and lubequi.lnamekey != ''">
					LNAMEKEY,
				</if>
				<if test="lubequi.lname != null and lubequi.lname != ''">
					LNAME,
				</if>
				<if test="lubequi.lnumber != null and lubequi.lnumber != ''">
					LNUMBER,
				</if>
				<if test="lubequi.lstate != null and lubequi.lstate != ''">
					LSTATE,
				</if>
				<if test="lubequi.ltype != null and lubequi.ltype != ''">
					LTYPE,
				</if>
				<if test="lubequi.lposition1 != null and lubequi.lposition1 != ''">
					LPOSITION1,
				</if>
				<if test="lubequi.lposition2 != null and lubequi.lposition2 != ''">
					LPOSITION2,
				</if>
				<if test="lubequi.isuser != null and lubequi.isuser != ''">
					ISUSER,
				</if>
				<if test="lubequi.lremark1 != null and lubequi.lremark1!= ''">
					LREMARK1,
				</if>
				<if test="lubequi.lremark2 != null and lubequi.lremark2!= ''">
					LREMARK2,
				</if>
			</trim>
		VALUES
		<trim prefix="(" suffix=")" suffixOverrides=",">
				<if test="lubequi.lid != null and lubequi.lid != ''">
					#{lubequi.lid},
				</if>
				<if test="lubequi.lnamekey != null and lubequi.lnamekey != ''">
					#{lubequi.lnamekey},
				</if>
				<if test="lubequi.lname != null and lubequi.lname != ''">
					#{lubequi.lname},
				</if>
				<if test="lubequi.lnumber != null and lubequi.lnumber != ''">
					#{lubequi.lnumber},
				</if>
				<if test="lubequi.lstate != null and lubequi.lstate != ''">
					#{lubequi.lstate},
				</if>
				<if test="lubequi.ltype != null and lubequi.ltype != ''">
					#{lubequi.ltype},
				</if>
				<if test="lubequi.lposition1 != null and lubequi.lposition1 != ''">
					#{lubequi.lposition1},
				</if>
				<if test="lubequi.lposition2 != null and lubequi.lposition2 != ''">
					#{lubequi.lposition2},
				</if>
				<if test="lubequi.isuser != null and lubequi.isuser != ''">
					#{lubequi.isuser},
				</if>
				<if test="lubequi.lremark1 != null and lubequi.lremark1!= ''">
					#{lubequi.lremark1},
				</if>
				<if test="lubequi.lremark2 != null and lubequi.lremark2!= ''">
					#{lubequi.lremark2},
				</if>
			</trim>	
	</insert>
	
	
	<!-- 新增换油部位 -->
	<!-- Integer insertLubPlace(@Param("lubequipl")LubricateEquipmentPlace lubricateEquipmentPlace); -->
	<insert id="insertLubPlace"	parameterType="cn.soa.entity.lubrication.LubricateEquipmentPlace">
		<selectKey order="BEFORE" resultType="string" keyProperty="lubequipl.pid">
			select sys_guid() from dual 
		</selectKey>
	
		INSERT INTO
			IOT_EQUIPMENT_LUBRICATE_PLACE
			<trim prefix="(" suffix=")" suffixOverrides=",">
				<if test="lubequipl.pid != null and lubequipl.pid != ''">
					PID,
				</if>
				<if test="lubequipl.lid != null and lubequipl.lid != ''">
					LID,
				</if>
				<if test="lubequipl.pplace != null and lubequipl.pplace != ''">
					PPLACE,
				</if>
				<if test="lubequipl.pnote != null and lubequipl.pnote != ''">
					PNOTE,
				</if>
				<if test="lubequipl.ptype != null and lubequipl.ptype != ''">
					PTYPE,
				</if>
				<if test="lubequipl.requireoil1 != null and lubequipl.requireoil1 != ''">
					REQUIREOIL1,
				</if>
				<if test="lubequipl.requireoil2 != null and lubequipl.requireoil2 != ''">
					REQUIREOIL2,
				</if>
				<if test="lubequipl.pfrequency != null and lubequipl.pfrequency != ''">
					PFREQUENCY,
				</if>
				<if test="lubequipl.punit != null and lubequipl.punit != ''">
					PUNIT,
				</if>
				<if test="lubequipl.plastamount != null and lubequipl.plastamount != ''">
					PLASTAMOUNT,
				</if>
				<if test="lubequipl.pamount != null and lubequipl.pamount != ''">
					PAMOUNT,
				</if>
				<if test="lubequipl.nextchangetime != null">
					NEXTCHANGETIME,
				</if>
				<if test="lubequipl.lastchangetime != null">
					LASTCHANGETIME,
				</if>
				<if test="lubequipl.premark1 != null and lubequipl.premark1 != ''">
					PREMARK1,
				</if>
				<if test="lubequipl.premark2 != null and lubequipl.premark2 != ''">
					PREMARK2,
				</if>
			</trim>
		VALUES
			<trim prefix="(" suffix=")" suffixOverrides=",">
				<if test="lubequipl.pid != null and lubequipl.pid != ''">
					#{lubequipl.pid},
				</if>
				<if test="lubequipl.lid != null and lubequipl.lid != ''">
					#{lubequipl.lid},
				</if>
				<if test="lubequipl.pplace != null and lubequipl.pplace != ''">
					#{lubequipl.pplace},
				</if>
				<if test="lubequipl.pnote != null and lubequipl.pnote != ''">
					#{lubequipl.pnote},
				</if>
				<if test="lubequipl.ptype != null and lubequipl.ptype != ''">
					#{lubequipl.ptype},
				</if>
				<if test="lubequipl.requireoil1 != null and lubequipl.requireoil1 != ''">
					#{lubequipl.requireoil1},
				</if>
				<if test="lubequipl.requireoil2 != null and lubequipl.requireoil2 != ''">
					#{lubequipl.requireoil2},
				</if>
				<if test="lubequipl.pfrequency != null and lubequipl.pfrequency != ''">
					#{lubequipl.pfrequency},
				</if>
				<if test="lubequipl.punit != null and lubequipl.punit != ''">
					#{lubequipl.punit},
				</if>
				<if test="lubequipl.plastamount != null and lubequipl.plastamount != ''">
					#{lubequipl.plastamount},
				</if>
				<if test="lubequipl.pamount != null and lubequipl.pamount != ''">
					#{lubequipl.pamount},
				</if>
				<if test="lubequipl.nextchangetime != null">
					#{lubequipl.nextchangetime},
				</if>
				<if test="lubequipl.lastchangetime != null">
					#{lubequipl.lastchangetime},
				</if>
				<if test="lubequipl.premark1 != null and lubequipl.premark1 != ''">
					#{lubequipl.premark1},
				</if>
				<if test="lubequipl.premark2 != null and lubequipl.premark2 != ''">
					#{lubequipl.premark2},
				</if>
			</trim>
	</insert>
	
	<!-- ===========================3、修改=============================== 

	油品入库
	Integer updateStock(String ramount,String oid);
	
	<update id="updateStock" parameterType="java.lang.Integer">
		UPDATE 
			IOT_lubEquiMENT_LUBRICATION_OIL
				<set>
				   ostock = ostock+#{ramount}
				</set>
				<where>
					oid = #{oid}
				</where>
	</update> -->
	
	<!-- ===========================4、删除===============================  -->
			
	
</mapper>
 

