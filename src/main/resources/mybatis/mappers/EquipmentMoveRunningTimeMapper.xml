<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="cn.soa.dao.EquipmentMoveRunningTimeMapper">

	<!-- ===========================1、查询===============================  -->
	<!-- 1.1、分页查找动设备信息	-->
	<!-- List<EquipmentMoveRunningTime> findByPage(
			@Param("equip") EquipmentMoveRunningTime equip, 
			@Param("page") Integer page, 
			@Param("limit") Integer limit) -->
	
	<sql id="EquipmentMoveRunningTimeSQL">
		MRID mrid, POSITIONNUM positionNum, NAME name, DCSPOSITIONNUM dcsPositionNum,
		REMARK1 remark1, REMARK2 remark2, EQUIPTYPE equipType, RNUMBER rnumber
	</sql>
			
	<select id="findByPage" resultType="cn.soa.entity.EquipmentMoveRunningTime">
		SELECT
			<include refid="EquipmentMoveRunningTimeSQL"></include>
		FROM
			(
				SELECT ROWNUM rownum1, equip.*
				FROM
					IOT_EQUIPMENT_MOVE_RUNNINGTIME equip
				<where>
					<if test="equip != null">
						<if test="equip.mrid != null and equip.mrid != ''">
							MRID = #{equip.mrid}
						</if>
						<if test="equip.positionNum != null and equip.positionNum != ''">
							AND lower(POSITIONNUM) LIKE lower('%'||#{equip.positionNum}||'%')
						</if>
						<if test="equip.name != null and equip.name != ''">
							AND lower(NAME) LIKE lower('%'||#{equip.name}||'%')
						</if>
						<if test="equip.dcsPositionNum != null and equip.dcsPositionNum != ''">
							AND DCSPOSITIONNUM = #{equip.dcsPositionNum}
						</if>
						<if test="equip.remark1 != null and equip.remark1 != ''">
							AND REMARK1 = #{equip.remark1}
						</if>
						<if test="equip.remark2 != null and equip.remark2 != ''">
							AND REMARK2 = #{equip.remark2}
						</if>
						<if test="equip.equipType != null and equip.equipType != ''">
							AND EQUIPTYPE = #{equip.equipType}
						</if>
					</if>
					<if test="limit != null and page != null">
						AND ROWNUM &lt;= ${page * limit}
					</if>
				</where>
			) equip_result
			WHERE
				<if test="limit != null and page != null">
						rownum1 &gt; ${(page-1) * limit}
				</if>
	</select>	
	
	<!-- 1.2、根据条件统计动设备信息条数	-->
	<!-- Integer countByCondition(@Param("equip") EquipmentMoveRunningTime equip) -->
	<select id="countByCondition" resultType="int">
		SELECT
			count(1)
		FROM
			IOT_EQUIPMENT_MOVE_RUNNINGTIME
		<where>
			<if test="equip != null">
				<if test="equip.mrid != null and equip.mrid != ''">
					MRID = #{equip.mrid}
				</if>
				<if test="equip.positionNum != null and equip.positionNum != ''">
					AND lower(POSITIONNUM) LIKE lower('%'||#{equip.positionNum}||'%')
				</if>
				<if test="equip.name != null and equip.name != ''">
					AND lower(NAME) LIKE lower('%'||#{equip.name}||'%')
				</if>
				<if test="equip.dcsPositionNum != null and equip.dcsPositionNum != ''">
					AND DCSPOSITIONNUM = #{equip.dcsPositionNum}
				</if>
				<if test="equip.remark1 != null and equip.remark1 != ''">
					AND REMARK1 = #{equip.remark1}
				</if>
				<if test="equip.remark2 != null and equip.remark2 != ''">
					AND REMARK2 = #{equip.remark2}
				</if>
				<if test="equip.equipType != null and equip.equipType != ''">
					AND EQUIPTYPE = #{equip.equipType}
				</if>
			</if>
		</where>
	</select>
	
	<!-- 1.3、根根据设备位号查询设备mrid	-->
	<!-- String findMridByPositionNum(String positionNum) -->
	<select id="findMridByPositionNum" resultType="string">
		SELECT 
			MRID
		FROM 
			IOT_EQUIPMENT_MOVE_RUNNINGTIME
		WHERE 
			POSITIONNUM = #{POSITIONNUM}
	</select>
	
	<!-- 1.4、查找所有的需要监控设备运行时间的设备	-->	
	<select id="findAll" resultType="cn.soa.entity.EquipmentMoveRunningTime">
		SELECT
			<include refid="EquipmentMoveRunningTimeSQL"></include>
		FROM IOT_EQUIPMENT_MOVE_RUNNINGTIME		
	</select>

	<!-- ===========================2、新增===============================  -->
	<!-- 2.1 添加动设备信息  -->
	<!-- Integer insertOne(@Param("equip") EquipmentMoveRunningTime equip) -->
	<insert id="insertOne" parameterType="cn.soa.entity.EquipmentMoveRunningTime">
		<selectKey order="BEFORE" resultType="string" keyProperty="mrid">
			select sys_guid() from dual 
		</selectKey>
		INSERT INTO
			IOT_EQUIPMENT_MOVE_RUNNINGTIME
			(MRID, POSITIONNUM, NAME, DCSPOSITIONNUM, EQUIPTYPE)
		VALUES
			<trim suffix=")" prefix="(" suffixOverrides=",">
				#{mrid, jdbcType=VARCHAR},
				#{equip.positionNum, jdbcType=VARCHAR},
				#{equip.name, jdbcType=VARCHAR},
				#{equip.dcsPositionNum, jdbcType=VARCHAR},
				#{equip.equipType, jdbcType=VARCHAR}
			</trim>
			
	</insert>
	
	
	<!-- ===========================3、修改===============================  -->

	
	<!-- ===========================4、删除===============================  -->
			
	
</mapper>
 

